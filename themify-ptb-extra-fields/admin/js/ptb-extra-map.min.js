var ptb_extra_geocoder;
function ptb_extra_map_init(t){function l(c,b,e){ptb_extra_geocoder||(ptb_extra_geocoder=new google.maps.Geocoder);var a={};a[b]=c;ptb_extra_geocoder.geocode(a,function(a,c){"OK"!==c&&(a[0]=null);e(a[0])})}function g(g,b,e,a,l,f,h,n,p,k){a?(a.geometry.viewport?g.fitBounds(a.geometry.viewport):(g.setCenter(a.geometry.location),g.setZoom(17)),a.icon?b.setIcon({url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}):
b.setIcon(),b.setPosition(k?k:a.geometry.location),b.setVisible(!0),p||(c.trim(e.val())?f=c.trim(e.val()).replace(/(?:\r\n|\r|\n)/ig,"<br />"):(a.address_components&&(f=[a.address_components[0]&&a.address_components[0].short_name||"",a.address_components[1]&&a.address_components[1].short_name||"",a.address_components[2]&&a.address_components[2].short_name||""].join(" ")),e.val(f),f="<div><strong>"+a.name+"</strong><br>"+f)),h.setContent(f),h.open(g,b),k||n.val(a.geometry.location.lat()+", "+a.geometry.location.lng()),
l.val(JSON.stringify({place:a.place_id,location:k?k:a.geometry.location}))):(l.val(""),n.val(""),b.setVisible(!1))}var c=jQuery;c(".ptb_post_cmb_item_map").each(function(){var u={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13},b=c(this).prop("id"),e=new google.maps.Map(document.getElementById("ptb_extra_"+b+"_canvas"),u),a=document.getElementById("ptb_extra_"+b+"_location"),u=document.getElementById("ptb_extra_"+b+"_select");e.controls[google.maps.ControlPosition.TOP_LEFT].push(a);e.controls[google.maps.ControlPosition.TOP_LEFT].push(u);
var r=new google.maps.places.Autocomplete(a);r.bindTo("bounds",e);var f=new google.maps.InfoWindow,h=new google.maps.Marker({map:e,anchorPoint:new google.maps.Point(0,-29),draggable:!0,animation:google.maps.Animation.DROP}),n=!1,p=c("#ptb_extra_"+b+"_place"),k=c("#ptb_extra_"+b+"_info"),q=c("#ptb_extra_"+b+"_lat"),d=p.val();d&&(d=c.parseJSON(d))&&(d.location?(b=d.location.lat?d.location.lat:d.location[0],d=d.location.lng?d.location.lng:d.location[1],h.setPosition({lat:b,lng:d}),e.setCenter({lat:b,
lng:d}),c.trim(k.val())&&(f.setContent(c.trim(k.val())),f.open(e,h)),q.val(b+", "+d)):d.place&&(new google.maps.places.PlacesService(e)).getDetails({placeId:d.place},function(m,b){b===google.maps.places.PlacesServiceStatus.OK&&(n=m,google.maps.event.trigger(r,"place_changed",t),m.formatted_address?c(a).val(m.formatted_address):c(a).val(m.name))}));google.maps.event.addListener(h,"dragend",function(){q.val(h.getPosition().lat()+", "+h.getPosition().lng())});google.maps.event.addListener(r,"place_changed",
function(m){f.close();h.setVisible(!1);var b="";if(n)m=n,b=c.trim(k.val()),n=!1;else{var d=c.trim(c(a).val());if(""!==d){if(m=m?!1:r.getPlace(),!m||!m.geometry){l(d,"address",function(a){a&&a.geometry?g(e,h,k,a,p,b,f,q,n):alert("Autocomplete's returned place contains no geometry")});return}}else{g(e,h,k,"",p,b,f,q,n);return}}g(e,h,k,m,p,b,f,q,n)});google.maps.event.addListener(h,"click",function(){f.open(e,h)});google.maps.event.addDomListener(a,"keydown",function(a){13===a.keyCode&&event.preventDefault()});
q.on("change",function(){var b=c.trim(c(this).val());""!==b?(b=b.split(","),b[1]&&(b={lat:parseFloat(c.trim(b[0])),lng:parseFloat(c.trim(b[1]))},l(b,"location",function(d){d&&d.geometry?(c(a).val(d.formatted_address),g(e,h,k,d,p,"",f,q,!1,b)):alert("Autocomplete's returned place contains no geometry")}))):g(e,h,k,"",p,"",f,q,!1)});c(u).change(function(){r.setTypes([c(this).val()])});k.keyup(function(){var a=c.trim(c(this).val()).replace(/(?:\r\n|\r|\n)/ig,"<br />");f.setContent(a)})})}
(function(t){t(document).on("ptb_metabox_create_map",function(l){}).on("ptb_add_metabox_map",function(l){return{}}).on("ptb_metabox_save_map",function(l){}).on("ptb_post_cmb_map_body_handle",function(l){}).ready(function(){if(0<t(".ptb_post_cmb_item_map").length)if("object"!==typeof google||"object"!==typeof google.maps||"undefined"===typeof google.maps.places){"object"===typeof google&&null!==google&&"object"===typeof google.maps&&"undefined"===typeof google.maps.places&&(google.maps=null);var l=
"//maps.googleapis.com/maps/api/js?v=3&signed_in=false&libraries=places&callback=ptb_extra_map_init&language="+ptb_extra.lng+"&key="+ptb_extra.map_key,g=document.createElement("script");g.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(g);g.defer=!0;g.async=!0;g.src=l}else ptb_extra_map_init()})})(jQuery);
